# 5.4 \[PS\] Walking

 ![[COMP3121_9101-5.4.pdf#height=600]] 

## Problem Description

> [!problem]
> <b>Instance:</b>
> Given a graph $G=(V, E)$ with $n$ vertices and $m$ edges (simple, unweighted, undirected and connected), two vertices $s, t \in V$  and an integer $k \geq 0$.
> 
> <b>Task:</b> 
> Count the number of **walks** from $s$ to $t$ that use exactly $k$ edges. A *walk* is a sequence of vertices (with repetitions of vertices and edges allowed) such that every adjacent pair of vertices in the sequence is an edge of the graph.
> 
> Design an algorithm whose running time is $O(km)$, where $m$ is the total number of edges in the graph $|E|$ and $k$ is the length (number of edges) of the walk.
> 

<b>Definitions:</b> 
An undirected graph is *connected* if every vertex is reachable from every other vertex. 

A *walk* of length $r - 1$ is a sequence of vertices $[v_1, v_2, \ldots, v_{r}]$ such that $\{v_i, v_{i+1}\} \in E$ for $i=1, 2, \ldots, r-1$. A walk may include the same vertices or the same edges multiple times.

TL;DR: A *walk* in an undirected graph $G$ is a sequence of vertices, where each adjacent pair of vertices are adjacent in $G$. Informally, a walk can also be seen as a sequence of edges. A walk is called a *path* if it visits each vertex at most once. 


## Dynamic Programming Solution

Similar to [[Single Source Shortest Paths (SSSP)|Bellman-Ford Algorithm]]: For every vertex $t$ and for every integer $i$ number of edges, find the *minimum distance from $s$ to $t$* that uses *at most $i$ edges*. 
- Need to keep track of the number of edges for each $s \to t$ path.
- Instead of "minimum distance", the operation is "sum of counts".

> [!solution]
> <b>Subproblems:</b>
> For all $0 \leq i \leq k$ and all $t \in V$, let $\operatorname{walks}(i, t)$ be the number of walks from $s$ to $t$ that uses exactly $i$ edges. 
> 
> <b>Recurrence:</b>  
> For all $i > 0$ and all $t \in V$, 
> 
> $$
> \operatorname{walks}(i,t) = \sum_{v:(v, t) \in E} \operatorname{walks}(i - 1, v)
> $$
> 
> <b>Base cases:</b>  
> $$
> \operatorname{walks}(0,s) = 1, \ \operatorname{walks}(0,t) = 0 \text{ for all } t \ne s.
> $$
> 
> Base case occurs when $i=0$ (no edges; zero length walk):
> 
> ==There’s exactly one length-0 walk from each node to itself but none to any other node.==
> 
> - $\operatorname{walks}(0,s) = 1$ (number of edges from the source to itself is one)
> - for all $t \neq s, \, \operatorname{walks}(0,t) = 0$ (can't reach any other vertex with zero edges)
> 
> <b>Order of computation:</b>  
> Solve subproblems in increasing order of $i$ (and any order of $t$),  since $\operatorname{walks}(i,t)$ depends only on $\operatorname{walks}(i - 1,v)$ for various $v$.
> 
> <b>Overall answer:</b>  
> The final answer is $\operatorname{walks}(k, t)$.
> 
> <b>Time complexity:</b>  
> There are $k$ rounds: $i = 0, 1, \ldots, k$.  
> In each round, each edge $(v,t)$ of the graph is considered only once.  
> Therefore, the time complexity is $O(km)$.
> 

### Subproblems

For every integer $i$ with $0 \leq i \leq k$ and for every vertex $t \in V$, let 

$$\operatorname{walks}(i, t) = \text{number of walks from } s \text{ to } t \text{ that use exactly } i \text{ edges}.$$


### Recurrence

Because the graph is **undirected**, every edge $(u, v)$ can be used in both directions in a walk.  

For every $i = 1, 2, \ldots, k$ and for every vertex $t \in V$:

$$
\operatorname{walks}(i,t) = \sum_{v: (v, t) \in E} \operatorname{walks}(i - 1, v)
$$


### Base cases

 Base case occurs when $i=0$ (no edges; zero length walk).
 
There’s exactly one length-0 walk from each node to itself but none to any other node. 

- For $t=s, \, \operatorname{walks}(0, s) = 1$ there is exactly one length-0 walk from $s$ to $s$ that uses exactly $0$ edges (number of edges from the source to itself is one)
- For all $t \neq s, \, \operatorname{walks}(0,t) = 0$ (can't reach any other vertex with zero edges)

### Order of computation

- Solve subproblems in increasing order of $i$, for  $i = 1, 2, \ldots, k$.
- For each $i$, solve $\operatorname{walks}(i, t)$ for all vertices $t \in V$ in any order, since each $(i,t)$ depends on values from the previous round $(i-1)$ i.e., $\operatorname{walks}(i - 1,v)$.

|$i$|$t_1$|$t_2$|…|$t_n$|
|:-:|:-:|:-:|:-:|:-:|
|0|walks(0,t₁)|walks(0,t₂)|…|walks(0,tₙ)|
|1|walks(1,t₁)|walks(1,t₂)|…|walks(1,tₙ)|
|2|walks(2,t₁)|walks(2,t₂)|…|walks(2,tₙ)|
|⋮|⋮|⋮||⋮|
|k|walks(k,t₁)|walks(k,t₂)|…|walks(k,tₙ)|


### Time complexity

> [!definition] Notation
> Let $n = |V|$ and $m = |E|$.

- There are $O(kn)$ subproblems, one for each pair $(i, t)$ with $0 \le i \le k$ and $t \in V$. 
- To compute $\operatorname{walks}(i,t)$, we sum over all in-neighbours $v$ of $t$, that is, over all edges $(v,t) \in E$. Across all vertices, this takes $O(m)$ time per round$i$.
- Hence, the total running time is $O(km)$.

### Proof

