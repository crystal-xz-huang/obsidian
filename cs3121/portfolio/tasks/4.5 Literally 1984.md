# 4.5 \[CR\] Literally 1984

![[COMP3121_9101-4.5.pdf#height=700]]

Related Problems:
- https://leetcode.com/problems/partition-array-for-maximum-sum/

## Problem Description

Given:
- a boolean array $\text{Vote}[1..n]$, where $\text{Vote}[i] = 1$ if resident $i$ voted for $\text{Oceania}$ and $\text{Vote}[i] = 0$ if resident $i$ voted for $\text{Eurasia}$.

$$\text{Vote[i]} =  
\begin{cases}  
1, & \text{if house } i \text{ voted for Oceania},\\[4pt]  
0, & \text{if house } i \text{ voted for Eurasia.}  
\end{cases}  
$$

- an integer $k$, where the number of houses in each district must lie between $k$ and $2k$ (inclusive)

$$
\text{District} =  [ \; i, i + 1, \dots, j \; ] 
k \leq  (j - i + 1) \leq  2k 
$$

Task:
- Describe an $O(nk^2)$ algorithm that returns the largest number of favourable districts in any legal partition of the houses.

Description:
- There are $n$ houses on High Street, living on consecutive addresses labelled $1, 2, \dots, n$. Each voting district is an interval of addresses $i, i + 1, \dots, j$ with $1 \leq i < j \leq n$. 
- A district is *favourable* if more than half of the houses in the district voted $\text{Oceania}$; 

## Abstraction

> [!abstraction]
> Given an array of votes and an integer $k$, partition the array into contiguous subarrays (districts) such that each subarray has a length between $k$ and $2k$, and the number of subarrays with more than half $1$s is maximized.

TL;DR: Partition the array into segments of length between k and 2k, and count how many segments have more than half 1s.

## Formulae

In a district $[i..j]$, the number of houses who voted for Oceania is given by the sum:

$$\textsf{Sum}(i,j) = \sum_{k=i}^{j} \text{Vote}[k]$$

And the number of houses in the district is 

$$\textsf{DistrictSize}(i,j) = j - i + 1$$

Therefore, a district is favourable if more than half the houses voted Oceania:

$$
\textsf{Favourable}(i,j) = \sum_{k=i}^{j} \text{Vote}[k] > \frac{j - i + 1}{2}
$$

## Implementation

Let opt(i) be the maximum number of favourable districts that can be formed using the first i votes.

To compute opt(i), we need to consider all possible district sizes from k to 2k and check if forming a district of that size ending at i yields a favourable district.

Then, the optimal solution can be expressed as:

```
opt(i) = max(opt(i - size) + favourable) for size in [k, 2k] if i - size >= 0
```

where `favourable = 1 if sum(vote[i-length:i]) > length / 2 else 0`

```python
def legal_partition(self, vote: list[int], k: int) -> int:
	"""    
	For each position i, consider all possible district lengths from k to 2k.
	For each length, check if the district formed by the last 'length' houses is favourable.
	Base Case: dp[0] = 0
	Time Complexity: O(n * k), where n is the length of the vote array
	Space Complexity: O(n) for the dp array
	"""
	n = len(vote)

	# Prefix sum to count number of 1s up to each index
	prefix_ones = [0] * (n + 1)
	for i in range(1, n + 1):
		prefix_ones[i] = prefix_ones[i - 1] + vote[i - 1]

	# DP array to store maximum number of favourable districts up to index i
	dp = [0] * (n + 1)

	for i in range(1, n + 1):
		for j in range(k, 2 * k + 1):
			if i - j >= 0:
				total_votes = j
				ones_count = prefix_ones[i] - prefix_ones[i - j]
				if ones_count > total_votes / 2:
					dp[i] = max(dp[i], dp[i - j] + 1)
	return dp[n]
```

```python
def legal_partition(self, vote: list[int], k: int) -> int:
	n = len(vote)
	dp = [0] * (n + 1)

	for i in range(1, n + 1):
		for length in range(k, 2 * k + 1):
			if i - length >= 0:
				district_votes = vote[i - length : i]
				favourable = 1 if sum(district_votes) > length / 2 else 0
				dp[i] = max(dp[i], dp[i - length] + favourable)
	return dp[n]
```


## Solution

---

**Subproblems**

For each $1 \leq i \leq n$, let $\operatorname{opt}(i)$ denote the largest number of favourable districts in any legal partition of the first $i$ houses. (in the interval $[1..i]$)

- “Legal” = Every district in the partition has length between k to 2k.
- Partition = Split houses 1, 2, …, i into consecutive districts (intervals) so that every house belongs to exactly one district.

---

**Reasoning**

Suppose we have opt(i) and we know the previous solutions: opt(1), opt(2), …, opt(i-1).
How do we solve for opt(i) using the previous answers?


**Recurrence**

Any partition of $1..i$ must have one (last) district that ends at $i$.
Denote the start of that last district as $p$.
Each district must have between $k$ and $2k$ houses so:

$$k \le i - p + 1 \le 2k.$$

Given $i$, $j$, we can determine whether that voting district is favourable by summing all the votes and returning "True" if more than half of the houses in the district voted Oceania:

$$
\textsf{Favourable}(i,j) = \sum_{k=i}^{j} \text{Vote}[k] > \frac{j - i + 1}{2}
$$

The final recurrence:

$$
\operatorname{opt}(i) =
\max_{\substack{k \le i-p+1 \le 2k \\ 1 \le p \le i}}
\big(
\operatorname{opt}(p-1) + \text{Favourable}(p, i)
\big).
$$

---

$$
\operatorname{MaxPartition}(i) =
\max_{\substack{k \le d \le 2k \\ i - d \geq 0}}
\left\{\operatorname{MaxPartition}(i - d) + \operatorname{Favourable}\right\}.
$$

where $\operatorname{Favourable}$ is $1$ if the district formed by the last $d$ houses is favourable, otherwise $0$.

$$
\operatorname{Favourable} =
\begin{cases}
1 & \text{if } \sum_{k=i-d+1}^{i} \operatorname{Vote}[k] > d / 2, \\
0 & \text{otherwise.}
\end{cases}
$$

Equivalently:

$$\boxed{
\operatorname{MaxPartition}(i) =
\max_{\substack{k \le d \le 2k \\ i - d \geq 0}}
\begin{cases}
\operatorname{MaxPartition}(i - d) + 1 & \text{if } \sum_{j=i-d+1}^{i} \operatorname{Vote}[j] > d / 2, \\
\operatorname{MaxPartition}(i - d) & \text{otherwise.}
\end{cases}
}
$$

---


## Formal Solution

**Solution**
For each $1 \leq i \leq n$, let $\operatorname{MaxPartition}(i)$ denote the largest number of favourable districts in any legal partition of the first $i$ houses. 

For $i \ge k$, any legal partition must include at least one district ending at $i$. This district is formed by the last $d$ houses where $k \le d \le 2k$, and is only valid if $i-d \geq 0$ (i.e., there are enough houses to form the district). Therefore, we can consider all possible districts ending at $i$ with sizes from $k$ to $2k$, and check if that district is favourable. If they are, we add $1$ to the maximum number of favourable districts that can be formed using the first $i-d$ houses. We maximise this over all possible partitions, giving the recurrence:

$$
\operatorname{MaxPartition}(i) =
\max_{\substack{k \le d \le 2k \\ i - d \geq 0}}
\begin{cases}
	\operatorname{MaxPartition}(i - d) + 1 & \text{if } \sum_{j=i-d+1}^{i} \operatorname{Vote}[j] > d / 2, \\[2pt]
	\operatorname{MaxPartition}(i - d) & \text{otherwise.}
\end{cases}
$$

The base case is $\operatorname{MaxPartition}(0) = 0$. We also consider the edge case when $1 \le i < k$, in which we return $0$. The final solution is returned by $\operatorname{MaxPartition}(n)$, where we fill the dynamic programming table in increasing order of $i$.

There are $O(n)$ subproblems and each subproblem can be solved in $O(k)$ time; therefore, the overall time complexity is $O(nk)$.

**Subproblem**
For each $1 \leq i \leq n$, let $\operatorname{MaxPartition}(i)$ denote the largest number of favourable districts in any legal partition of the first $i$ houses. 

**Recurrence**
For $i \ge k$, any legal partition must include at least one district ending at $i$. This district is formed by the last $d$ houses where $k \le d \le 2k$, and is only valid if $i-d \geq 0$ (i.e., there are enough houses to form the district). Therefore, for we can consider all possible districts ending at $i$ with sizes from $k$ to $2k$, and check if there are favourable. If they are, we add $1$ to the maximum number of favourable districts that can be formed using the first $i-d$ houses. We maximise this over all possible partitions, giving the recurrence:

$$
\operatorname{MaxPartition}(i) = 
\max_{\substack{k \le d \le 2k \\ i - d \geq 0}}
\left\{
\operatorname{MaxPartition}(i - d) + \verb|favourable|
\right\}.
$$

where $\verb|favourable|$ is $1$ if the district formed by the last $d$ houses is favourable, otherwise $0$.

To determine whether a district is $\textit{favourable}$, we can define a function $\operatorname{Favourable}(i, j)$ that returns $1$ if and only if a district in the interval $[i..j]$ is favourable:

$$ 
\operatorname{Favourable}(i, j) = 
\begin{cases} 
1 & \text{if } \sum_{k=i}^{j} \text{Vote}[k] > \frac{j - i + 1}{2},\\ 
0 & \text{otherwise.} \end{cases} 
$$

Thus, the final recurrence is

$$
\operatorname{MaxPartition}(i)
=
\max_{\substack{k \le d \le 2k \\ i - d \geq 0}}
\left\{
\operatorname{MaxPartition}(i - d) + \operatorname{Favourable}(i-d+1, i)
\right\}.
$$

---
