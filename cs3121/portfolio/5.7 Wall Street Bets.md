# 5.7 \[DN\] Wall Street Bets

![[COMP3121_9101-5.7.pdf#height=650]]
> [!abstraction]
> <b>Inputs.</b>
> - An integer $n$, the number of days.
> - A sequence $(C_1, C_2, \dots, C_n)$ where $C_i \ge 0$ represents the profit earned by investing on day $i$.
> - A constraint parameter $k$, where $k = 1$ in part (a) and $1 < k < n$ in part (b), indicating the maximum number of **consecutive days ($i$ and $i+1$)** allowed for investment.undefined
> 
> <b>Task.</b>
> Determine the **maximum total profit** Satoshi can achieve by selecting a subset of days to invest such that there are **no more than $k$ consecutive investment days**.

> [!example]
> For example, suppose $k=1$, $n = 6$ and $C = [15, 14, 13, 16, 12, 13]$.
> The optimal strategy is to invest on days 1, 2, 4 and 6, for a total of 58 dollars.

## Part (a) One Consecutive 

- $k=1$: allowed to invest on consecutive days *exactly once* over the $n$ days.
- Investing on days $\{1,2,3\}$ has two consecutive/adjacent days $(1,2)$ and $(2,3)$. 

> [!example]
> For each $1 \le i \le n$, let $\operatorname{IntComp}(i)$ denote the minimum number of one’s such that any expression involving addition and multiplication equates to $n$. The subproblem satisfies the following recurrence:
> 
> $$
> \operatorname{IntComp}(i) = \min\left.
> \begin{cases}
> \min\{\operatorname{IntComp}(d) + \operatorname{IntComp}(i - d) : 1 \le d < i\},\\
> \min\{\operatorname{IntComp}(d) + \operatorname{IntComp}(i/d) : 1 \le d < i,\; d \mid i\}\\
> \end{cases}
> \right\}.
> $$
> > The “$: \text{condition}$” after each set specifies the **domain of valid indices** over which the maximum is taken.
> 
>  The base case occurs at $i = 1$ with $\operatorname{IntComp}(1) = 1$ and define $\operatorname{IntComp}(j) = 0$ for all non-integers $j$. The final solution is returned by $\operatorname{IntComp}(n)$, where we fill the dynamic programming table in increasing order of $i$.

> [!example]
> `C = [15, 14, 13, 16, 12, 13]`
> 
> | i / j | 0                      | 1                             |
> | ----- | ---------------------- | ----------------------------- |
> | 0     | `0`                    | `0`                           |
> | 1     | `15` (1)               | `15` (1)                      |
> | 2     | `15` (1)               | `15, 14` (1, 2)               |
> | 3     | `15, 13` (1, 3)        | `15, 13` (1, 3)               |
> | 4     | `15, 16` (1, 4)        | `15, 14, 16` (1, 2, 4)        |
> | 5     | `15, 13, 12` (1, 3, 5) | `15, 16, 12` (1, 4, 5)        |
> | 6     | `15, 16, 13` (1, 4, 6) | `15, 14, 16, 13` (1, 2, 4, 6) |

1. If i = 0 then opt(i, j) = 0 (no days left or no consecutive investments allowed).
2. If i = 1 then opt(i, j) = c[1] (only one day to invest).

Otherwise:
If we invest:
- opt(i, j) = max( opt(i-1), 
- opt(1-2, j) + Ci of 
if we don't invest: opt(i-1, j)

 In row i = 1, we can only compare (i-1, j) and (i-1, j-1) 
In col j = 0, we can only compare (i-1, j) and  opt(i-2, j)

## Recursive Solution

For $1 \leq i \leq n$ and $0 \leq j \leq k$:

Let $\text{opt}$ denote the maximum investment profit that can be achieved over the first $i$ days with at most $j$ consecutive investments.

> For each investment, we can choose to either invest on day $i$ or not invest on day $i$. 

There are 2 choices:

- **Case 1.** Invest on day i 
	- `C[i] + opt(i-2, j)` if  `i >= 2` (and `j >= 0`),
	- `C[i] + opt(i-1, j-1)` if `i >= 1` and `j >= 1`,
	- `C[i]` otherwise.

In this case, we can either add to  `opt(i-2, j)` w/o adding a new consecutive pair for total of $j$ consecutive pairs, or extend from `opt(i-1, j-1)` 


$$
\operatorname{opt}(i,j) =
\max\left.
\begin{cases}
C_i + \operatorname{opt}(i-2,j) &\text{if } i \geq 2 ,\\[6pt]
C_i + \operatorname{opt}(i-1,j-1)  &\text{if } i, j \geq 1,\\[6pt]
C_i &\text{otherwise.}
\end{cases}
\right\}.
$$


- **Case 2.** Don't invest on day i 
	- `opt(i-1, j)` given that `i >= 1` (and `j >= 0`),
	- `0` otherwise (if `i = 0`).

$$
\operatorname{opt}(i,j) =
\begin{cases}
\operatorname{opt}(i-1,j)  &\text{if } i \geq 1,\\[6pt]
0 &\text{otherwise.}
\end{cases}
$$

---

Since we do not know which case gives us the maximum, we just consider both.


If j = 0 and 1 ≤ i ≤ n:
- Ci if i = 1 
- max of opt(i-1, j) and opt(i-2, j) + Ci otherwise

If j ≥ 1 and 1 ≤ i ≤ n:
- Ci + opt(i-2, j) if i = 1
- max of Ci + opt(i-1, j-1) and Ci + opt(i-2, j) otherwise

$$
\operatorname{opt}(i,j) = \max\left.
\begin{cases}
C_i + \max\left\{\operatorname{opt}(i-2, j), \; \operatorname{opt}(i-1, j-1) \right\},  \\[6pt]
\operatorname{opt}(i-1,j)
\end{cases}
\right\}.
$$

$$
\operatorname{opt}(i,j) =
\begin{cases}
C_i + \operatorname{opt}(i-1,j-1)  &\text{if } j = 0 \\[6pt]
C_i + \operatorname{opt}(i-2,j) &\text{if } i \geq 2 ,\\[6pt]
C_i &\text{otherwise.}
\end{cases}
$$




---

$$
\operatorname{opt}(i,j) = \max\left.
\begin{cases}
C_i + \max\left\{\operatorname{opt}(i-2, j), \; \operatorname{opt}(i-1, j-1) \right\},  \\[6pt]
\operatorname{opt}(i-1,j)
\end{cases}
\right\}.
$$

or altogether:
$$
\operatorname{opt}(i,j) = \max\left.
\begin{cases}
C_i + \max\left\{\operatorname{opt}(i-2, j), \; \operatorname{opt}(i-1, j-1) \right\},  \\[6pt]
\operatorname{opt}(i-1,j)
\end{cases}
\right\}.
$$


---

The base cases occur when $i=0$, in which case we have that $\operatorname{opt}(0, j) = 0$.

Now consider the base cases:
1. If i < 0 or j = 0, then opt(i, j) = 0 (no days left or no consecutive investments allowed).
2. If i = 0 and j >= 1, then opt(i, j) = c[0] (only one day to invest).



### Solution

For $1 \leq i \leq n$ and $0 \leq j \leq k$, let $\operatorname{MaxProfit}$ denote the maximum investment profit that can be achieved over the first $i$ days with at most $j$ consecutive investments.

Base cases: 
When i = 0, there is nothing to invest on day 0 so 
- opt(0, j) = 0 for all j

When j = 0, there is only no consecutive 

The base case ocrurs at $i=0$ with 
and define IntComp(i, j) = 0 for all non-integers j.


$$
\operatorname{opt}(i,j)=\max\left.
\begin{cases}
\operatorname{opt}(i{-}1,j),\\
C_i+\max\big\{\operatorname{opt}(i{-}2,j),\ \operatorname{opt}(i{-}1,j{-}1)\big\}
\end{cases}
\right\}.
$$


Base cases: $\operatorname{opt}(0,j)=0$ for all $j\ge 0$, and any term with an invalid index (e.g. $i<0$ or $j<0$) is treated as $-\infty$.



> [!solution]
> **Subproblems:**
> 
> For all $1\le i\le n$, for all $0\le j\le k$, and for $c\in\{0,1\}$, let
>
> $$
> \operatorname{opt}(i,j,c)
> $$
>
> be the maximum total profit that can be achieved over the first $i$ days, with exactly $j$ consecutive investments, and with $c=1$ if day $i$ is invested, $c=0$ otherwise.
> 
> The overall answer (for at most $k$ adjacent pairs) is
>
> $$
> \max_{0\le j\le k,\; c\in\{0,1\}}\operatorname{DP}(n,j,c).
> $$
>
> For part (a), restrict $j\in\{0,1\}$ and (if $C_i\ge0$ and $n\ge2$) the maximum will in fact occur at $j=1$.
>
> **Recurrence:**
> 
> For $i\ge2$ and $0\le j\le k$:
> 
> - If day $i$ is **not taken** ($c=0$):
>
> $$
>   \operatorname{DP}(i,j,0)
>   = \max\big(\operatorname{DP}(i{-}1,j,0),\ \operatorname{DP}(i{-}1,j,1)\big).
>   $$
>
> - If day $i$ **is taken** ($c=1$):
>
> $$
>   \operatorname{DP}(i,j,1)
>   = C_i+\max\Big(
>       \underbrace{\operatorname{DP}(i{-}1,j,0)}_{\text{no new adjacency}},\ 
>       \underbrace{\operatorname{DP}(i{-}1,j{-}1,1)}_{\text{new adjacency; valid if }j\ge1}
>     \Big),
>   $$
>
> where $\operatorname{DP}(i{-}1,j{-}1,1)=-\infty$ if $j=0$.
> 
> **Base cases:**
> 
> For $i=1$:
>
> $$
> \operatorname{DP}(1,0,0)=0,\qquad
> \operatorname{DP}(1,0,1)=C_1,\qquad
> \operatorname{DP}(1,j,c)=-\infty\text{ for }j>0.
> $$
>
> **Order of computation:**
> 
> Compute in lexicographic order of $(i,j,c)$:
> 
> - For $i=1,2,\dots,n$  
> - For $j=0,1,\dots,k$  
> - Compute both $c \in \{0, 1\}$. 
> - Compute $\operatorname{DP}(i,j,0)$ then $\operatorname{DP}(i,j,1)$
> 
> This ensures that every dependency $\operatorname{DP}(i{-}1,*,*)$ is already available when computing $\operatorname{DP}(i,*,*)$.
> 
> **Overall answer:**
>
> $$
> \max_{0\le j\le k,\ c\in\{0,1\}}\operatorname{DP}(n,j,c).
> $$
>
> For part (a): $k=1$; if $C_i\ge0$ and $n\ge2$, this achieves $j=1$ automatically.
> 
> **Time complexity:**
> 
> There are $O(nk)$ subproblems, each computed in $O(1)$ time, giving total $O(nk)$.
> For part (a), this simplifies to $O(n)$ time and $O(1)$ space.

